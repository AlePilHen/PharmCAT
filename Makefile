MAKEFLAGS = -j1

# Determine this makefile's path.
# Be sure to place this BEFORE `include` directives, if any.
THIS_FILE := $(lastword $(MAKEFILE_LIST))

ifeq ($(OS),Windows_NT)
	GRADLE_CMD := cmd /c gradlew.bat --console=plain
else
	GRADLE_CMD := ./gradlew --console=plain
endif


.PHONY: vcfTests
vcfTests:
	${GRADLE_CMD} clean
	rm -rf build/testVcf build/autogeneratedTestResults build/pharmcat_positions.vcf
	${GRADLE_CMD} extractPositionsForTest
	src/scripts/generate_vcf_test_data.sh
	${GRADLE_CMD} testAutogeneratedVcfs
	cd build; zip -r vcfTest-`date +'%Y-%m-%d'`.zip autogeneratedTestResults

.PHONY: exactVcfTests
exactVcfTests:
	${GRADLE_CMD} clean
	rm -rf build/testVcf build/autogeneratedTestResults build/pharmcat_positions.vcf
	${GRADLE_CMD} extractPositionsForTest
	src/scripts/generate_vcf_test_data.sh
	${GRADLE_CMD} testAutogeneratedVcfsExactMatchOnly
	cd build; zip -r vcfTest-`date +'%Y-%m-%d'`-exact.zip autogeneratedTestResults

.PHONY: fuzzyVcfTests
fuzzyVcfTests:
	${GRADLE_CMD} clean
	rm -rf build/testVcf build/autogeneratedTestResults build/pharmcat_positions.vcf
	${GRADLE_CMD} extractPositionsForTest
	src/scripts/generate_vcf_test_data.sh
	${GRADLE_CMD} testAutogeneratedVcfsFuzzyMatch
	cd build; zip -r vcfTest-`date +'%Y-%m-%d'`-fuzzy.zip autogeneratedTestResults

.PHONY: updateData
updateData:
	${GRADLE_CMD} clean
	${GRADLE_CMD} updateData
	${GRADLE_CMD} extractPositionsForDocs
	cp build/pharmcat_positions.vcf PharmCAT.wiki/pharmcat.example.vcf
	if [ -f "build/positions_reference.tsv" ]; then \
	  cp build/positions_reference.tsv src/main/resources/org/pharmgkb/pharmcat/definition; \
	fi
