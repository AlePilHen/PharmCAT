<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>
    PharmCAT Report{{#if title}} [{{title}}]{{/if}}
  </title>

  {{> "header"}}

</head>
<body>
<!--[if lt IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
<header class="pageHeader">
  <div class="title">
    PharmCAT Report
    {{#if title}}<div class="subtitle">{{title}}</div>{{/if}}
  </div>
  <div class="metadata">
    <table>
      <tr><th>Date created</th><td>{{generatedOn}}</td></tr>
      <tr><th>PharmCAT Version</th><td>{{pharmcatVersion}}</td></tr>
      <tr><th>CPIC Version</th><td>{{cpicVersion}}</td></tr>
    </table>
  </div>
</header>
<main>
  <section>
    <h2>Sections</h2>
    <ol type="I">
      <li><a href="#section-i">Genotype Summary</a></li>
      <li><a href="#section-ii">Prescribing Recommendations</a></li>
      <li><a href="#section-iii">Allele Matching Details</a></li>
      <li><a href="#disclaimer">Disclaimers</a></li>
    </ol>

    <div class="alert alert-info">
      <em>Disclaimer:</em> PharmCAT is only able to generate recommendations based on the information provided to the
      software. The gene and variant information for all reported sections are interpreted directly from user-supplied data.
      The user recognizes they are using PharmCAT at their own risk. For a detailed disclaimer see
      <a href="#disclaimer">Section IV</a>.
    </div>
  </section>


  <section id="section-i">
    <h2>Section I: Genotype Summary</h2>

    <p>Genotypes called: {{calledGenes}} / {{totalGenes}} </p>

    <table class="genotypeSummary">
      <thead>
      <tr>
        <th>Drugs</th>
        <th>Gene</th>
        <th>
          Genotypes
          <table class="diplotype table-small">
            <tbody>
            <tr>
              <td>Genotype</td>
              <td>Allele Functionality</td>
              <td>Phenotype</td>
            </tr>
            </tbody>
          </table>
        </th>
      </tr>
      </thead>
      <tbody>
      {{#each summaries}}
        <tr class="top-aligned">
          <td>
            {{#each relatedDrugs}}
              {{#if (gsShowDrug this ../../drugs) }}
                <div class="drugName"><a href="#{{this}}">{{this}}</a></div>
              {{/if}}
            {{/each}}
          </td>
          <td>
            <span class="noWrap">
              <a href="#{{symbol}}" class="normalWrap">{{symbol}}</a>
              {{#if hasMessages}}<sup><a href="#genotypes-dagger">&dagger;</a></sup>{{/if}}
              {{#if showUnphasedNote}}<sup><a href="#genotypes-ddagger">&ddagger;</a></sup>{{/if}}
            </span>
          </td>
          <td>
            <table class="diplotype">
              <tbody>
              {{#if showComponents}}
                {{#with diplotypes}}
                  <tr class="leastFunctionDiplotype">
                    <td colspan="3"><b>{{gsCall}}</b></td>
                  </tr>
                {{/with}}
                {{#each componentDiplotypes}}
                  <tr class="top-aligned">
                    <td>{{gsCall}}</td>
                    <td>{{gsFunction}}</td>
                    <td>{{gsPhenotype}}</td>
                  </tr>
                {{/each}}
              {{else}}
                <!-- standard diplotype -->
                {{#each diplotypes}}
                  <tr class="top-aligned">
                    <td>{{gsCall}}</td>
                    <td>{{gsFunction}}</td>
                    <td>{{gsPhenotype}}</td>
                  </tr>
                {{/each}}
              {{/if}}
              </tbody>
            </table>
            {{#if hasMissingVariants}}
              <p class="missingVariantsNote">
                Genotypes based on missing variant input <sup><a href="#genotypes-star">*</a></sup>.
              </p>
            {{/if}}
          </td>
        </tr>
      {{/each}}
      </tbody>
    </table>

    {{#if hasMissingVariants}}
      <div class="footnote" id="genotypes-star">
        <sup>*</sup> Some alleles were not considered for the genotype calls due to missing variant information.
        Please see <a href="#section-iii">Section III</a> for details. Alleles that could not be considered due to
        missing input might change the metabolizer phenotype and possible recommendation.
      </div>
    {{/if}}
    {{#if hasMessages}}
        <div class="footnote" id="genotypes-dagger">
          <sup>&dagger;</sup> Check <a href="#section-iii">Section III</a> for more details about this call.
        </div>
    {{/if}}
    {{#if hasUnphasedNote}}
      <div class="footnote" id="genotypes-ddagger">
        <sup>&ddagger;</sup> PharmCAT reports the genotype(s) that receive the highest score during the matcher process.
        In case of unphased data, additional genotypes might be possible and cannot be ruled out.
      </div>
    {{/if}}
    <div class="footnote">
      For a full list of disclaimers and limitations see the <a href="#disclaimer">Section IV</a>.
    </div>

    {{#if hasCombo}}
      <div class="alert alert-info">
        Partial and combination allele calls are based on the variants identified in the VCF file. Matches to different
        star allele definitions or star allele with additional position combinations are connected by a '+', which
        represents combinations in a single gene copy per allele and does NOT indicate gene duplications.
      </div>
    {{/if}}
    {{#each summaryMessages}}
      <div class="alert alert-info">{{this}}</div>
    {{/each}}
  </section>


  <section id="section-ii">
    <h2>Section II: Prescribing Recommendations</h2>

    {{#each recommendations}}
      <section class="guideline">
        <h3 id="{{drug}}">{{drug}}</h3>

        {{#if multiMatch}}
          <div class="alert alert-info">
            <strong>Note:</strong> More than one call was made for the applicable gene so multiple annotation groups
            could be shown.
          </div>
        {{/if}}

        {{#each messages}}
          <div class="alert alert-info">{{{this}}}</div>
        {{/each}}

        {{#if image}}
          <div class="image"><img src="{{image/url}}" alt="{{image/altText}}"/></div>
        {{/if}}

        <table>
          <thead>
          <tr>
            <th>Guideline</th>
            <th>Genes</th>
            <th>Implications</th>
            <th>Recommendation</th>
            <th>Comments</th>
            <th>Classification</th>
          </tr>
          </thead>
          <tbody>
          {{#each reports}}
            {{#if matched}}
              {{#each guidelines}}
                {{#each annotationGroups}}
                  <tr class="top-aligned" id="#{{../id}}">
                    <td>
                      <p>
                        <b>{{source.displayName}}</b>
                        {{#unless uncallable}}
                          <sup class="sources">
                            {{{listSources urls}}}
                          </sup>
                        {{/unless}}
                      </p>
                      <p>Population:<br />{{population}}</p>
                    </td>
                    <td>
                      <div class="hint">{{pluralize "Genotype" genotypes}}</div>
                      <ul class="{{#if (moreThanOne genotypes) }}noPadding{{else}}noBullet{{/if}} mt-0">
                        {{#each genotypes}}
                          <li>
                            <span class="noWrap">
                              <span class="normalWrap">{{{rxGenotype this}}}</span>
                              {{#if (rxInferred this)}}<sup><a href="#rx-dagger" title="Inferred">&dagger;</a></sup>{{/if}}
                              {{#if (rxDpydInferred this)}}<sup><a href="#rx-ddagger" title="Inferred">&ddagger;</a></sup>{{/if}}
                            </span>
                          </li>
                        {{/each}}
                      </ul>
                      {{#if (thereAre phenotypes)}}
                        <div class="hint">{{pluralize "Phenotype" phenotypes}}</div>
                        {{{printRecMap phenotypes}}}
                      {{/if}}
                      {{#if (thereAre activityScores)}}
                        <div class="hint">{{pluralize "Activity Score" activityScores}}</div>
                        {{{printRecMap activityScores}}}
                      {{/if}}
                    </td>
                    <td>{{{implications}}}</td>
                    <td>{{{drugRecommendation}}}</td>
                    <td>{{comments}}</td>
                    <td>{{classification}}</td>
                  </tr>
                {{/each}}
              {{/each}}
            {{else}}
              <tr>
                <td class="top-aligned">
                  <p>
                    <b>{{source.displayName}}</b>
                    {{#unless uncallable}}
                      <sup class="sources">
                        {{{listSources urls}}}
                      </sup>
                    {{/unless}}
                  </p>
                </td>
                <td colspan="5" class="top-aligned">
                  {{#if uncallable}}
                    No call data for {{uncalledGenes}}.
                  {{else}}
                    No annotation for {{{unmatchedCalls}}}.
                  {{/if}}
                </td>
              </tr>
            {{/if}}
          {{/each}}
          </tbody>
        </table>

        {{#if hasInferred}}
          <div class="footnote" id="rx-dagger">
            <sup>&dagger;</sup> Inferred Genotype used to look up Phenotype.
          </div>
        {{/if}}
        {{#if hasDpydInferred}}
          <div class="footnote" id="rx-ddagger">
            <sup>&ddagger;</sup> The DPYD genotype used to look up phenotype is inferred from the two lowest function
            haplotypes. Consult the
            {{{externalHref "https://pharmcat.org/methods/gene-definition-exceptions/#dpyd" "PharmCAT documentation"}}}
            for details.
          </div>
        {{/if}}

        {{#each footnotes}}
          <div class="footnote">{{this}}</div>
        {{/each}}

        {{#if (thereAre citations)}}
          <div class="citations">
            <p>Citations:</p>
            <ul>
              {{#each citations}}
                <li>{{{printCitation this}}}</li>
              {{/each}}
            </ul>
          </div>
        {{/if}}
      </section>
    {{/each}}
  </section>


  <section id="section-iii">
    <h2>Section III: Allele Matching Details</h2>

    <ol>
      {{#each geneReports}}
        <li><a href="#{{geneDisplay}}">{{geneDisplay}} allele match data</a></li>
      {{/each}}
    </ol>

    {{#each geneReports}}
      <section class="gene">
        <h3 id="{{geneDisplay}}">{{geneDisplay}} allele match data</h3>

        {{#if (amdNoCall)}}
          <div class="alert alert-warning">
            {{amdGeneCall this}}.
          </div>
        {{else}}
          <table>
            <tbody>
            <tr>
              <th style="width: 12em;">{{amdSubtitle this}}:</th>
              <td class="top-aligned">
                {{#if (amdIsSingleCall this) }}
                  {{amdGeneCall this}}
                {{else}}
                  <ul class="noPadding mt-0">
                    {{#each (amdGeneCalls this) }}
                      <li>{{this}}</li>
                    {{/each}}
                  </ul>
                {{/if}}
              </td>
            </tr>
            {{#if (thereAre variantReports)}}
              <tr>
                <th>Phasing Status:</th>
                <td class="top-aligned">
                  <p>
                    {{amdPhaseStatus this}}
                  </p>
                  {{#if (amdShowUnphasedNote this) }}
                    <p>
                      PharmCAT reports the genotype(s) that receive the highest score during the matcher process. In
                      case of unphased data, additional genotypes might be possible and cannot be ruled out.
                    </p>
                  {{/if}}
                </td>
              </tr>
            {{/if}}
            {{#if (amdHasUncalledHaps this) }}
              <tr>
                <th>Alleles Not Considered:</th>
                <td class="top-aligned">
                  <p>
                    The following alleles are not considered due to {{amdTotalMissingVariants this}} missing positions of the
                    total {{amdTotalVariants this}} positions: {{amdUncalledHaps this}}
                  </p>
                  <p>
                    Carriage of these alleles might result in a different phenotype and different guideline recommendations.
                  </p>
                </td>
              </tr>
            {{/if}}
            </tbody>
          </table>
        {{/if}}

        {{#each (amdMessages this) }}
          <div class="alert alert-warning">{{{this}}}</div>
        {{/each}}

      {{#unless (amdNoCall) }}
        {{#if (thereAre variantReports)}}
            <h4>Calls at Positions</h4>
            <table>
              <thead>
              <tr>
                <th>Position in VCF</th>
                <th>RSID</th>
                <th>Call in VCF</th>
                <th>Reference</th>
                <th>Related Alleles</th>
                <th>Warnings</th>
              </tr>
              </thead>
              <tbody>
              {{#each variantReports}}
                <tr>
                  <td id="{{chr}}_{{position}}">{{chr}}:{{position}}</td>
                  <td id="{{dbSnpId}}">{{dbSnpId}}</td>
                  {{#if missing}}
                    <td class="missingVariant"><div class="callMessage">Missing</div></td>
                  {{/if}}
                  {{#unless missing}}
                    {{{variantAlleles this}}}
                  {{/unless}}
                  <td>
                    {{wildtypeAllele}}
                  </td>
                  <td>
                    {{#each alleles}}{{this}} {{/each}}
                  </td>
                  <td>
                    <ul class="warningList">
                      {{#each warnings}}<li>{{this}}</li>{{/each}}
                    </ul>
                  </td>
                </tr>
              {{/each}}
              </tbody>
            </table>
        {{/if}}

        {{#if (thereAre variantOfInterestReports) }}
            <h4>Other Positions of Interest</h4>
          {{#each (amdExtraPositionNotes this) }}
              <div class="alert alert-warning">{{{this}}}</div>
          {{/each}}
            <table>
              <thead>
              <tr>
                <th>Position in VCF</th>
                <th>RSID</th>
                <th>Call in VCF</th>
              </tr>
              </thead>
              <tbody>
              {{#each variantOfInterestReports}}
                <tr>
                  <td id="{{position}}">{{chr}}:{{position}}</td>
                  <td id="{{dbSnpId}}">{{dbSnpId}}</td>
                  {{#if missing}}
                    <td class="missingVariant"><em>missing</em></td>
                  {{/if}}
                  {{#unless missing}}
                    {{{variantAlleles this}}}
                  {{/unless}}
                </tr>
              {{/each}}
              </tbody>
            </table>
        {{/if}}

      {{/unless}}

      </section>
    {{/each}}

  </section>

  {{> "disclaimers"}}

</main>
</body>
</html>
